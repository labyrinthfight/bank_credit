<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ë–∞–Ω–∫–æ–≤—Å–∫–∞—è —Å–∏—Å—Ç–µ–º–∞ - –í—ã–¥–∞—á–∞ –∫—Ä–µ–¥–∏—Ç–æ–≤</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: #333;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }
        
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #eee;
        }
        
        h1 {
            color: #2a5298;
            font-size: 28px;
        }
        
        .logo {
            font-size: 24px;
            font-weight: bold;
            color: #1e3c72;
        }
        
        .stats-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }
        
        .card h3 {
            font-size: 14px;
            opacity: 0.9;
            margin-bottom: 10px;
        }
        
        .card .value {
            font-size: 32px;
            font-weight: bold;
        }
        
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid #eee;
            padding-bottom: 10px;
        }
        
        .tab {
            padding: 10px 20px;
            background: #f5f5f5;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
        }
        
        .tab:hover {
            background: #e0e0e0;
        }
        
        .tab.active {
            background: #2a5298;
            color: white;
        }
        
        .content-section {
            display: none;
            padding: 20px;
            background: #f9f9f9;
            border-radius: 10px;
            margin-bottom: 30px;
        }
        
        .content-section.active {
            display: block;
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .btn {
            background: #2a5298;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 500;
            transition: background 0.3s;
        }
        
        .btn:hover {
            background: #1e3c72;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        th, td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }
        
        th {
            background: #2a5298;
            color: white;
            font-weight: 500;
        }
        
        tr:hover {
            background: #f5f5f5;
        }
        
        .form-container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #555;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        .status {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: 500;
        }
        
        .status.active {
            background: #d4edda;
            color: #155724;
        }
        
        .status.pending {
            background: #fff3cd;
            color: #856404;
        }
        
        .sms-message {
            background: #e8f4fd;
            border-left: 4px solid #2a5298;
            padding: 15px;
            margin: 15px 0;
            border-radius: 0 5px 5px 0;
            font-style: italic;
        }
        
        .alert {
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
            display: none;
        }
        
        .alert.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .alert.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">üè¶ –ë–∞–Ω–∫–æ–≤—Å–∫–∞—è —Å–∏—Å—Ç–µ–º–∞</div>
            <h1>–í—ã–¥–∞—á–∞ –∫—Ä–µ–¥–∏—Ç–æ–≤ —é—Ä–∏–¥–∏—á–µ—Å–∫–∏–º –ª–∏—Ü–∞–º</h1>
        </header>
        
        <div class="stats-cards">
            <div class="card">
                <h3>–ö–ª–∏–µ–Ω—Ç–æ–≤</h3>
                <div class="value" id="clientsCount">0</div>
            </div>
            <div class="card">
                <h3>–ö—Ä–µ–¥–∏—Ç–æ–≤ –≤—ã–¥–∞–Ω–æ</h3>
                <div class="value" id="loansCount">0</div>
            </div>
            <div class="card">
                <h3>–ê–∫—Ç–∏–≤–Ω—ã—Ö –∫—Ä–µ–¥–∏—Ç–æ–≤</h3>
                <div class="value" id="totalLoans">0 ‚ÇΩ</div>
            </div>
        </div>
        
        <div class="tabs">
            <button class="tab active" onclick="showTab('clients')">üë• –ö–ª–∏–µ–Ω—Ç—ã</button>
            <button class="tab" onclick="showTab('loans')">üí∞ –ö—Ä–µ–¥–∏—Ç—ã</button>
            <button class="tab" onclick="showTab('new-loan')">‚ûï –ù–æ–≤–∞—è –≤—ã–¥–∞—á–∞</button>
            <button class="tab" onclick="showTab('loan-types')">üìã –¢–∏–ø—ã –∫—Ä–µ–¥–∏—Ç–æ–≤</button>
        </div>
        
        <!-- –°–µ–∫—Ü–∏—è –∫–ª–∏–µ–Ω—Ç–æ–≤ -->
        <div id="clients" class="content-section active">
            <div class="section-header">
                <h2>–°–ø–∏—Å–æ–∫ –∫–ª–∏–µ–Ω—Ç–æ–≤</h2>
                <button class="btn" onclick="showNewClientForm()">–î–æ–±–∞–≤–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–∞</button>
            </div>
            
            <div id="newClientForm" class="form-container" style="display: none;">
                <h3>–ù–æ–≤—ã–π –∫–ª–∏–µ–Ω—Ç</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label>–ù–∞–∑–≤–∞–Ω–∏–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ *</label>
                        <input type="text" id="clientName" placeholder="–û–û–û '–†–æ–º–∞—à–∫–∞'">
                    </div>
                    <div class="form-group">
                        <label>–í–∏–¥ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏</label>
                        <select id="clientOwnership">
                            <option value="–û–û–û">–û–û–û</option>
                            <option value="–ó–ê–û">–ó–ê–û</option>
                            <option value="–ü–ê–û">–ü–ê–û</option>
                            <option value="–ò–ü">–ò–ü</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label>–ê–¥—Ä–µ—Å</label>
                    <input type="text" id="clientAddress" placeholder="–ú–æ—Å–∫–≤–∞, —É–ª. –õ–µ–Ω–∏–Ω–∞ 10">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>–¢–µ–ª–µ—Ñ–æ–Ω</label>
                        <input type="text" id="clientPhone" placeholder="+7-999-123-45-67">
                    </div>
                    <div class="form-group">
                        <label>–ö–æ–Ω—Ç–∞–∫—Ç–Ω–æ–µ –ª–∏—Ü–æ</label>
                        <input type="text" id="clientContact" placeholder="–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤–∏—á">
                    </div>
                </div>
                <button class="btn" onclick="addClient()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–∞</button>
                <button class="btn" style="background: #6c757d;" onclick="hideNewClientForm()">–û—Ç–º–µ–Ω–∞</button>
            </div>
            
            <div id="alertClient" class="alert"></div>
            
            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                        <th>–í–∏–¥ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏</th>
                        <th>–ö–æ–Ω—Ç–∞–∫—Ç–Ω–æ–µ –ª–∏—Ü–æ</th>
                        <th>–¢–µ–ª–µ—Ñ–æ–Ω</th>
                    </tr>
                </thead>
                <tbody id="clientsTable">
                    <!-- –î–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∑–¥–µ—Å—å -->
                </tbody>
            </table>
        </div>
        
        <!-- –°–µ–∫—Ü–∏—è –∫—Ä–µ–¥–∏—Ç–æ–≤ -->
        <div id="loans" class="content-section">
            <div class="section-header">
                <h2>–í—ã–¥–∞–Ω–Ω—ã–µ –∫—Ä–µ–¥–∏—Ç—ã</h2>
            </div>
            
            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>–ö–ª–∏–µ–Ω—Ç</th>
                        <th>–¢–∏–ø –∫—Ä–µ–¥–∏—Ç–∞</th>
                        <th>–°—É–º–º–∞</th>
                        <th>–î–∞—Ç–∞ –≤—ã–¥–∞—á–∏</th>
                        <th>–°—Ç–∞—Ç—É—Å</th>
                    </tr>
                </thead>
                <tbody id="loansTable">
                    <!-- –î–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∑–¥–µ—Å—å -->
                </tbody>
            </table>
        </div>
        
        <!-- –°–µ–∫—Ü–∏—è –Ω–æ–≤–æ–π –≤—ã–¥–∞—á–∏ -->
        <div id="new-loan" class="content-section">
            <div class="section-header">
                <h2>–í—ã–¥–∞—á–∞ –Ω–æ–≤–æ–≥–æ –∫—Ä–µ–¥–∏—Ç–∞</h2>
            </div>
            
            <div class="form-container">
                <div class="form-row">
                    <div class="form-group">
                        <label>–ö–ª–∏–µ–Ω—Ç *</label>
                        <select id="loanClient">
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–ª–∏–µ–Ω—Ç–∞</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>–¢–∏–ø –∫—Ä–µ–¥–∏—Ç–∞ *</label>
                        <select id="loanType">
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –∫—Ä–µ–¥–∏—Ç–∞</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>–°—É–º–º–∞ –∫—Ä–µ–¥–∏—Ç–∞ (—Ä—É–±.) *</label>
                        <input type="number" id="loanAmount" placeholder="500000">
                    </div>
                    <div class="form-group">
                        <label>–î–∞—Ç–∞ –≤—ã–¥–∞—á–∏ *</label>
                        <input type="date" id="loanIssueDate">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>–î–∞—Ç–∞ –≤–æ–∑–≤—Ä–∞—Ç–∞</label>
                        <input type="date" id="loanReturnDate">
                    </div>
                    <div class="form-group">
                        <label>–°—Ç–∞—Ç—É—Å</label>
                        <select id="loanStatus">
                            <option value="–≤ –æ–±—Ä–∞–±–æ—Ç–∫–µ">–≤ –æ–±—Ä–∞–±–æ—Ç–∫–µ</option>
                            <option value="–∞–∫—Ç–∏–≤–µ–Ω">–∞–∫—Ç–∏–≤–µ–Ω</option>
                            <option value="–ø–æ–≥–∞—à–µ–Ω">–ø–æ–≥–∞—à–µ–Ω</option>
                            <option value="–ø—Ä–æ—Å—Ä–æ—á–µ–Ω">–ø—Ä–æ—Å—Ä–æ—á–µ–Ω</option>
                        </select>
                    </div>
                </div>
                
                <button class="btn" onclick="addLoan()">–û—Ñ–æ—Ä–º–∏—Ç—å –∫—Ä–µ–¥–∏—Ç</button>
                
                <div id="alertLoan" class="alert"></div>
                <div id="smsPreview" class="sms-message" style="display: none;">
                    <!-- SMS —Å–æ–æ–±—â–µ–Ω–∏–µ –±—É–¥–µ—Ç –ø–æ–∫–∞–∑–∞–Ω–æ –∑–¥–µ—Å—å -->
                </div>
            </div>
        </div>
        
        <!-- –°–µ–∫—Ü–∏—è —Ç–∏–ø–æ–≤ –∫—Ä–µ–¥–∏—Ç–æ–≤ -->
        <div id="loan-types" class="content-section">
            <div class="section-header">
                <h2>–¢–∏–ø—ã –∫—Ä–µ–¥–∏—Ç–æ–≤</h2>
            </div>
            
            <table>
                <thead>
                    <tr>
                        <th>–¢–∏–ø –∫—Ä–µ–¥–∏—Ç–∞</th>
                        <th>–£—Å–ª–æ–≤–∏—è</th>
                        <th>–°—Ç–∞–≤–∫–∞ (%)</th>
                        <th>–°—Ä–æ–∫ (–º–µ—Å.)</th>
                    </tr>
                </thead>
                <tbody id="loanTypesTable">
                    <!-- –î–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∑–¥–µ—Å—å -->
                </tbody>
            </table>
        </div>
    </div>

    <script>
        const API_URL = 'http://localhost:5001/api';
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        async function loadStats() {
            try {
                const response = await fetch(`${API_URL}/stats`);
                const stats = await response.json();
                
                document.getElementById('clientsCount').textContent = stats.clients_count;
                document.getElementById('loansCount').textContent = stats.loans_count;
                document.getElementById('totalLoans').textContent = 
                    new Intl.NumberFormat('ru-RU').format(stats.total_active_loans) + ' ‚ÇΩ';
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:', error);
            }
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤
        async function loadClients() {
            try {
                const response = await fetch(`${API_URL}/clients`);
                const clients = await response.json();
                
                const tbody = document.getElementById('clientsTable');
                tbody.innerHTML = '';
                
                clients.forEach(client => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${client.id}</td>
                        <td><strong>${client.name}</strong></td>
                        <td>${client.ownership_type || '-'}</td>
                        <td>${client.contact_person || '-'}</td>
                        <td>${client.phone || '-'}</td>
                    `;
                    tbody.appendChild(row);
                });
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å–µ–ª–µ–∫—Ç –¥–ª—è –≤—ã–¥–∞—á–∏ –∫—Ä–µ–¥–∏—Ç–æ–≤
                updateClientSelect(clients);
                
                if (clients.length === 0) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="5" style="text-align: center;">–ù–µ—Ç –∫–ª–∏–µ–Ω—Ç–æ–≤</td>
                        </tr>
                    `;
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤:', error);
            }
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–∏–ø–æ–≤ –∫—Ä–µ–¥–∏—Ç–æ–≤
        async function loadLoanTypes() {
            try {
                const response = await fetch(`${API_URL}/loan_types`);
                const types = await response.json();
                
                const tbody = document.getElementById('loanTypesTable');
                tbody.innerHTML = '';
                
                types.forEach(type => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td><strong>${type.name}</strong></td>
                        <td>${type.conditions || '-'}</td>
                        <td>${type.interest_rate || '0'}%</td>
                        <td>${type.term_months || '-'}</td>
                    `;
                    tbody.appendChild(row);
                });
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å–µ–ª–µ–∫—Ç –¥–ª—è –≤—ã–¥–∞—á–∏ –∫—Ä–µ–¥–∏—Ç–æ–≤
                updateLoanTypeSelect(types);
                
                if (types.length === 0) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="4" style="text-align: center;">–ù–µ—Ç —Ç–∏–ø–æ–≤ –∫—Ä–µ–¥–∏—Ç–æ–≤</td>
                        </tr>
                    `;
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–∏–ø–æ–≤ –∫—Ä–µ–¥–∏—Ç–æ–≤:', error);
            }
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –∫—Ä–µ–¥–∏—Ç–æ–≤
        async function loadLoans() {
            try {
                const response = await fetch(`${API_URL}/loans`);
                const loans = await response.json();
                
                const tbody = document.getElementById('loansTable');
                tbody.innerHTML = '';
                
                loans.forEach(loan => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${loan.id}</td>
                        <td>${loan.client_name}</td>
                        <td>${loan.loan_type_name}</td>
                        <td>${new Intl.NumberFormat('ru-RU').format(loan.amount)} ‚ÇΩ</td>
                        <td>${loan.issue_date ? new Date(loan.issue_date).toLocaleDateString('ru-RU') : '-'}</td>
                        <td><span class="status ${loan.status === '–∞–∫—Ç–∏–≤–µ–Ω' ? 'active' : 'pending'}">${loan.status}</span></td>
                    `;
                    tbody.appendChild(row);
                });
                
                if (loans.length === 0) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="6" style="text-align: center;">–ù–µ—Ç –≤—ã–¥–∞–Ω–Ω—ã—Ö –∫—Ä–µ–¥–∏—Ç–æ–≤</td>
                        </tr>
                    `;
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫—Ä–µ–¥–∏—Ç–æ–≤:', error);
            }
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–µ–ª–µ–∫—Ç–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤
        function updateClientSelect(clients) {
            const select = document.getElementById('loanClient');
            select.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–ª–∏–µ–Ω—Ç–∞</option>';
            
            clients.forEach(client => {
                const option = document.createElement('option');
                option.value = client.id;
                option.textContent = `${client.name} (${client.contact_person || '–±–µ–∑ –∫–æ–Ω—Ç–∞–∫—Ç–∞'})`;
                select.appendChild(option);
            });
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–µ–ª–µ–∫—Ç–∞ —Ç–∏–ø–æ–≤ –∫—Ä–µ–¥–∏—Ç–æ–≤
        function updateLoanTypeSelect(types) {
            const select = document.getElementById('loanType');
            select.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –∫—Ä–µ–¥–∏—Ç–∞</option>';
            
            types.forEach(type => {
                const option = document.createElement('option');
                option.value = type.id;
                option.textContent = `${type.name} (${type.interest_rate}%, ${type.term_months} –º–µ—Å.)`;
                select.appendChild(option);
            });
        }
        
        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞
        async function addClient() {
            const name = document.getElementById('clientName').value;
            const ownership = document.getElementById('clientOwnership').value;
            const address = document.getElementById('clientAddress').value;
            const phone = document.getElementById('clientPhone').value;
            const contact = document.getElementById('clientContact').value;
            
            if (!name) {
                showAlert('client', '–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏', 'error');
                return;
            }
            
            try {
                const response = await fetch(`${API_URL}/clients`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        name,
                        ownership_type: ownership,
                        address,
                        phone,
                        contact_person: contact
                    })
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    // –û—á–∏—â–∞–µ–º —Ñ–æ—Ä–º—É
                    document.getElementById('clientName').value = '';
                    document.getElementById('clientAddress').value = '';
                    document.getElementById('clientPhone').value = '';
                    document.getElementById('clientContact').value = '';
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ
                    loadClients();
                    loadStats();
                    showAlert('client', '–ö–ª–∏–µ–Ω—Ç —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω', 'success');
                    hideNewClientForm();
                } else {
                    showAlert('client', result.error || '–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏', 'error');
                }
            } catch (error) {
                showAlert('client', '–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è', 'error');
                console.error('Error:', error);
            }
        }
        
        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫—Ä–µ–¥–∏—Ç–∞
        async function addLoan() {
            const clientId = document.getElementById('loanClient').value;
            const typeId = document.getElementById('loanType').value;
            const amount = document.getElementById('loanAmount').value;
            const issueDate = document.getElementById('loanIssueDate').value;
            const returnDate = document.getElementById('loanReturnDate').value;
            const status = document.getElementById('loanStatus').value;
            
            if (!clientId || !typeId || !amount || !issueDate) {
                showAlert('loan', '–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è (*)', 'error');
                return;
            }
            
            try {
                const response = await fetch(`${API_URL}/loans`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        client_id: parseInt(clientId),
                        loan_type_id: parseInt(typeId),
                        amount: parseFloat(amount),
                        issue_date: issueDate,
                        return_date: returnDate || null,
                        status
                    })
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    // –û—á–∏—â–∞–µ–º —Ñ–æ—Ä–º—É
                    document.getElementById('loanAmount').value = '';
                    document.getElementById('loanIssueDate').value = '';
                    document.getElementById('loanReturnDate').value = '';
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º SMS —Å–æ–æ–±—â–µ–Ω–∏–µ
                    const smsDiv = document.getElementById('smsPreview');
                    smsDiv.innerHTML = `
                        <strong>üì± SMS —Å–æ–æ–±—â–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç—É:</strong><br>
                        "${result.sms}"
                    `;
                    smsDiv.style.display = 'block';
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ
                    loadLoans();
                    loadStats();
                    showAlert('loan', '–ö—Ä–µ–¥–∏—Ç —É—Å–ø–µ—à–Ω–æ –æ—Ñ–æ—Ä–º–ª–µ–Ω', 'success');
                    
                    // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ –≤–∫–ª–∞–¥–∫—É –∫—Ä–µ–¥–∏—Ç–æ–≤ —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
                    setTimeout(() => {
                        showTab('loans');
                        smsDiv.style.display = 'none';
                    }, 3000);
                } else {
                    showAlert('loan', result.error || '–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–∏', 'error');
                }
            } catch (error) {
                showAlert('loan', '–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è', 'error');
                console.error('Error:', error);
            }
        }
        
        // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–∫–ª–∞–¥–∫–∞–º–∏
        function showTab(tabName) {
            // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —Å–µ–∫—Ü–∏–∏
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });
            
            // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —É –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω—É–∂–Ω—É—é —Å–µ–∫—Ü–∏—é
            document.getElementById(tabName).classList.add('active');
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å –∫–Ω–æ–ø–∫–µ
            event.target.classList.add('active');
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∞–∫—Ç–∏–≤–Ω–æ–π –≤–∫–ª–∞–¥–∫–∏
            if (tabName === 'clients') {
                loadClients();
            } else if (tabName === 'loans') {
                loadLoans();
            } else if (tabName === 'loan-types') {
                loadLoanTypes();
            }
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å/—Å–∫—Ä—ã—Ç—å —Ñ–æ—Ä–º—É –Ω–æ–≤–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞
        function showNewClientForm() {
            document.getElementById('newClientForm').style.display = 'block';
        }
        
        function hideNewClientForm() {
            document.getElementById('newClientForm').style.display = 'none';
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ
        function showAlert(type, message, alertType) {
            const alertDiv = document.getElementById(`alert${type.charAt(0).toUpperCase() + type.slice(1)}`);
            alertDiv.textContent = message;
            alertDiv.className = `alert ${alertType}`;
            alertDiv.style.display = 'block';
            
            setTimeout(() => {
                alertDiv.style.display = 'none';
            }, 3000);
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', function() {
            loadStats();
            loadClients();
            loadLoanTypes();
            loadLoans();
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–µ–≥–æ–¥–Ω—è—à–Ω—é—é –¥–∞—Ç—É –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('loanIssueDate').value = today;
        });
    </script>
</body>
</html>